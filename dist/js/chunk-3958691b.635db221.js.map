{"version":3,"sources":["webpack:///./src/views/user/profile.vue?0b44","webpack:///src/views/user/profile.vue","webpack:///./src/views/user/profile.vue?4b70","webpack:///./src/views/user/profile.vue","webpack:///./src/views/user/profile.vue?eeb8"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","updatePhoto","$refs","refPhoto","click","user","photo","slot","name","clickShowName","gender","showGender","birthday","clickShowBirthday","saveName","model","value","callback","$$v","showName","expression","newName","trim","saveGender","showBirthday","minDate","maxDate","saveBirthday","newDate","staticRenderFns","data","Date","created","loadUserProfile","methods","component"],"mappings":"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","file":"js/chunk-3958691b.635db221.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"profile\"},[_c('van-nav-bar',{attrs:{\"left-arrow\":\"\",\"title\":\"编辑资料\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-cell-group',[_c('input',{ref:\"refPhoto\",attrs:{\"type\":\"file\",\"hidden\":\"\"},on:{\"change\":_vm.updatePhoto}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"头像\",\"center\":\"\"},on:{\"click\":function($event){return _vm.$refs.refPhoto.click()}}},[_c('van-image',{attrs:{\"slot\":\"default\",\"width\":\"1.5rem\",\"height\":\"1.5rem\",\"fit\":\"cover\",\"round\":\"\",\"src\":_vm.user.photo},slot:\"default\"})],1),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"名称\",\"value\":_vm.user.name},on:{\"click\":_vm.clickShowName}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"性别\",\"value\":_vm.user.gender === 0 ? '男' : '女'},on:{\"click\":function($event){_vm.showGender=true}}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"生日\",\"value\":_vm.user.birthday},on:{\"click\":_vm.clickShowBirthday}})],1),_c('van-dialog',{attrs:{\"title\":\"修改昵称\",\"show-cancel-button\":\"\"},on:{\"confirm\":_vm.saveName},model:{value:(_vm.showName),callback:function ($$v) {_vm.showName=$$v},expression:\"showName\"}},[_c('van-field',{attrs:{\"placeholder\":\"请输入昵称\"},model:{value:(_vm.newName),callback:function ($$v) {_vm.newName=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"newName\"}})],1),_c('van-popup',{attrs:{\"position\":\"bottom\"},model:{value:(_vm.showGender),callback:function ($$v) {_vm.showGender=$$v},expression:\"showGender\"}},[_c('van-nav-bar',{attrs:{\"title\":\"修改性别\",\"left-text\":\"取消\"},on:{\"click-left\":function($event){_vm.showGender=false}}}),_c('van-cell',{attrs:{\"title\":\"男\",\"is-link\":\"\"},on:{\"click\":function($event){return _vm.saveGender(0)}}}),_c('van-cell',{attrs:{\"title\":\"女\",\"is-link\":\"\"},on:{\"click\":function($event){return _vm.saveGender(1)}}})],1),_c('van-popup',{attrs:{\"position\":\"bottom\"},model:{value:(_vm.showBirthday),callback:function ($$v) {_vm.showBirthday=$$v},expression:\"showBirthday\"}},[_c('van-datetime-picker',{attrs:{\"type\":\"date\",\"title\":\"选择生日\",\"min-date\":_vm.minDate,\"max-date\":_vm.maxDate},on:{\"cancel\":function($event){_vm.showBirthday = false},\"confirm\":_vm.saveBirthday},model:{value:(_vm.newDate),callback:function ($$v) {_vm.newDate=$$v},expression:\"newDate\"}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"profile\">\r\n    <!-- 导航条 -->\r\n    <van-nav-bar left-arrow @click-left=\"$router.back()\" title=\"编辑资料\"></van-nav-bar>\r\n\r\n    <!-- 编辑区 -->\r\n    <van-cell-group>\r\n      <!-- 隐藏域(hidden) -->\r\n      <!-- hidden html表单元素的固有属性, 就类似于display: none的效果, 不占位置的 -->\r\n      <input @change=\"updatePhoto\" type=\"file\" hidden ref=\"refPhoto\">\r\n      <van-cell @click=\"$refs.refPhoto.click()\" is-link title=\"头像\"  center>\r\n        <van-image\r\n          slot=\"default\"\r\n          width=\"1.5rem\"\r\n          height=\"1.5rem\"\r\n          fit=\"cover\"\r\n          round\r\n          :src=\"user.photo\"\r\n        />\r\n      </van-cell>\r\n\r\n      <van-cell is-link title=\"名称\" :value=\"user.name\" @click=\"clickShowName\"/>\r\n      <!-- gender 0 男, 1 女 -->\r\n      <van-cell is-link title=\"性别\" :value=\"user.gender === 0 ? '男' : '女'\" @click=\"showGender=true\"/>\r\n      <van-cell is-link title=\"生日\" :value=\"user.birthday\" @click=\"clickShowBirthday\"/>\r\n    </van-cell-group>\r\n\r\n    <!-- 修改姓名的对话框 -->\r\n    <van-dialog @confirm=\"saveName\" v-model=\"showName\" title=\"修改昵称\" show-cancel-button>\r\n      <van-field v-model.trim=\"newName\" placeholder=\"请输入昵称\"></van-field>\r\n    </van-dialog>\r\n\r\n    <!-- 修改性别的弹出层 -->\r\n    <van-popup v-model=\"showGender\" position=\"bottom\">\r\n      <van-nav-bar title=\"修改性别\" left-text=\"取消\" @click-left=\"showGender=false\">\r\n      </van-nav-bar>\r\n      <van-cell title=\"男\" @click=\"saveGender(0)\" is-link></van-cell>\r\n      <van-cell title=\"女\" @click=\"saveGender(1)\" is-link></van-cell>\r\n    </van-popup>\r\n\r\n    <!-- 修改生日的弹出层 -->\r\n    <van-popup v-model=\"showBirthday\" position=\"bottom\">\r\n      <van-datetime-picker\r\n        @cancel=\"showBirthday = false\"\r\n        @confirm=\"saveBirthday\"\r\n        v-model=\"newDate\"\r\n        type=\"date\"\r\n        title=\"选择生日\"\r\n        :min-date=\"minDate\"\r\n        :max-date=\"maxDate\"\r\n      />\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { reqGetProfile, reqUpdateUserInfo, reqUpdatePhoto } from '@/api/user.js'\r\nimport dayjs from 'dayjs'\r\n\r\nexport default {\r\n  name: 'userProfile',\r\n  data () {\r\n    return {\r\n      // 控制弹层\r\n      showName: false,\r\n      showGender: false,\r\n      showBirthday: false,\r\n      // 当前用户的信息\r\n      user: {},\r\n      newName: '', // 用于存放编辑时的昵称\r\n      minDate: new Date(1900, 1, 1), // 生日可选的最小值\r\n      maxDate: new Date(), // 生日可选的最大值\r\n      newDate: new Date() // 用户修改的个人生日\r\n    }\r\n  },\r\n  created () {\r\n    this.loadUserProfile()\r\n  },\r\n  methods: {\r\n    async loadUserProfile () {\r\n      const res = await reqGetProfile()\r\n      this.user = res.data.data\r\n      console.log(res)\r\n    },\r\n    clickShowName () {\r\n      // 显示修改姓名的对话框\r\n      this.showName = true\r\n      // 显示的同时, 需要显示原有的姓名\r\n      this.newName = this.user.name\r\n    },\r\n    async saveName () {\r\n      try {\r\n        if (this.newName === '') return\r\n        if (this.newName.length > 7) {\r\n          this.$toast.fail('用户名长度不能超过7位字符')\r\n          return\r\n        }\r\n        // 用户点了保存, 提交修改姓名的ajax\r\n        await reqUpdateUserInfo({\r\n          name: this.newName\r\n        })\r\n        // 更新页面\r\n        this.user.name = this.newName\r\n        this.$toast.success('修改成功')\r\n      } catch {\r\n        this.$toast.fail('用户名已存在, 请重新编辑')\r\n      }\r\n    },\r\n\r\n    async saveGender (gender) {\r\n      try {\r\n        // 发送请求, 进行修改\r\n        await reqUpdateUserInfo({\r\n          gender\r\n        })\r\n        // 视图渲染\r\n        this.user.gender = gender\r\n        // 关闭弹框\r\n        this.showGender = false\r\n        // 提示\r\n        this.$toast.success('修改成功')\r\n      } catch {\r\n        this.$toast.fail('修改失败')\r\n      }\r\n    },\r\n\r\n    clickShowBirthday () {\r\n      // 1. 显示生日的日期框\r\n      this.showBirthday = true\r\n      // 2. 数据回显, 将生日赋值给日期框 xxxx-xx-xx 这种格式组件不识别\r\n      // 需要将字符串的日期, 转成标准的日期对象\r\n      this.newDate = new Date(this.user.birthday)\r\n    },\r\n    async saveBirthday () {\r\n      try {\r\n        // 后台的需要的格式是 xxxx-xx-xx 需要dayjs进行转换格式\r\n        const birthday = dayjs(this.newDate).format('YYYY-MM-DD')\r\n        await reqUpdateUserInfo({\r\n          birthday\r\n        })\r\n        // console.log(res, birthday)\r\n        // 视图的渲染\r\n        this.user.birthday = birthday\r\n        // 关闭弹层\r\n        this.showBirthday = false\r\n        // 提示\r\n        this.$toast.success('修改成功')\r\n      } catch {\r\n        this.$toast.fail('修改失败')\r\n      }\r\n    },\r\n\r\n    async updatePhoto () {\r\n      // input:file 框中, 有一个 files 属性(数组), 能够拿到选择的文件\r\n      // console.dir(this.$refs.refPhoto)\r\n      try {\r\n        this.$toast.loading({\r\n          duration: 0,\r\n          overlay: true,\r\n          message: '正在上传中...'\r\n        })\r\n\r\n        const file = this.$refs.refPhoto.files[0]\r\n        const formData = new FormData()\r\n        formData.append('photo', file)\r\n        const res = await reqUpdatePhoto(formData)\r\n        // 更新视图\r\n        this.user.photo = res.data.data.photo\r\n        // 提示用户\r\n        this.$toast.success('上传成功')\r\n      } catch {\r\n        this.$toast.fail('上传失败')\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.profile {\r\n  ::v-deep .van-nav-bar__text {\r\n    color: white;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./profile.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./profile.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./profile.vue?vue&type=template&id=373f3e9e&scoped=true&\"\nimport script from \"./profile.vue?vue&type=script&lang=js&\"\nexport * from \"./profile.vue?vue&type=script&lang=js&\"\nimport style0 from \"./profile.vue?vue&type=style&index=0&id=373f3e9e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"373f3e9e\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./profile.vue?vue&type=style&index=0&id=373f3e9e&lang=scss&scoped=true&\""],"sourceRoot":""}